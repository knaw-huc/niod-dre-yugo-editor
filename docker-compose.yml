version: '2'

services:
  sd-editor:
    image: registry.diginfra.net/tsd/huc-editor-services:2.0-RC9
    entrypoint: [ "sh", "-c", "sleep 90 && python src/main.py" ]
    depends_on:
      - nominatim
    environment:
      - BASE_URL=http://localhost:1211
      - CDN_URL=http://localhost:1310
      - ES_URL=http://elastic:9200/
    volumes:
      - ./data:/home/huc/huc-editor-service/data
    networks:
      - sd-editor
    ports:
      - '1211:1210'
  
  nominatim:
    image: mediagis/nominatim:5.1
    environment:
      - PBF_URL=https://download.geofabrik.de/europe/croatia-latest.osm.pbf
      - REPLICATION_URL=https://download.geofabrik.de/europe/croatia-updates
      #- PBF_PATH=/home/huc/huc-editor-service/data/osm/europe-latest.osm.pbf
    #volumes:
      #- ./data:/home/huc/huc-editor-service/data
    networks:
      - sd-editor
    ports:
      - 1311:8080

  elastic:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.10.4
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    volumes:
      - ./index:/usr/share/elasticsearch/data
    ports:
      - 9200:9200
      - 9300:9300
    networks:
      - sd-editor
  
  kibana:
      image: docker.elastic.co/kibana/kibana:8.10.4
      environment:
        ELASTICSEARCH_URL: http://elastic:9200
        ELASTICSEARCH_HOSTS: '["http://elastic:9200"]'    
      ports:
        - 5601:5601 
      networks:
        - sd-editor

  sd-editor-cdn:
    image: registry.diginfra.net/tsd/huc-generic-editor:1.3-RC4-alpha
    restart: unless-stopped
    ports:
      - 1310:80
    networks:
      - sd-editor

  yugo-browser:
    build:
      context: ./browser
    ports:
      - '5050:5000'
    environment:
      - ES_URL=http://elastic:9200/
    networks:
      - sd-editor

networks:
  sd-editor:
    external: false
